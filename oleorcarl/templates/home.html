<!-- prettier-ignore -->
{% extends "base.html" %}
{% block main %}

<div class="px-5 lg:pt-20">
  <header class="scale-[.8] md:scale-100">
    <h1
      class="flex flex-col items-center justify-center lg:flex-row lg:gap-10"
      style="font-size: 12rem"
    >
      <span
        class="-mb-10 -rotate-6 font-['Calluna'] tracking-tighter text-stolaf-primary"
      >
        OLE
      </span>
      <span class="text-5xl">or</span>
      <span class="rotate-6"
        ><img
          src="{{ url_for('static', filename='images/carl.svg') }}"
          style="height: 0.8em"
          alt="Carl"
      /></span>
    </h1>
  </header>

  <main class="mt-10 flex flex-col items-center gap-10">
    <h2 class="max-w-xl text-center text-xl tracking-wider" id="blurb">
      <em>The</em> definitive source for determining if you're crazy for
      thinking that one blonde girl in your 8:30 Spanish looks like she goes to
      the other (worse) Northfield college.
    </h2>

    <div class="grid w-full max-w-lg gap-6">
      <div class="relative w-full">
        <label class="text-xs text-gray-400" for="name">Name</label> <br />
        <input
          class="w-full rounded-lg border-2 border-green bg-gray-100 p-1"
          id="searchbar"
          type="text"
          name="name"
          placeholder="Start typing to see results"
        />

        <ul
          class="absolute top-16 hidden max-h-52 w-full space-y-2 divide-y-2 overflow-y-scroll rounded-md bg-gray-50 p-3 shadow-md"
          id="suggestions"
        >
          <template id="suggestion">
            <li>
              <a href="{{url_for('home_page')}}" class="-space-y-1">
                <p></p>
                <small class="text-gray-500"></small>
              </a>
            </li>
          </template>
        </ul>
      </div>
    </div>
  </main>
</div>

{# search suggestions script #}
<script>
  const blurb = document.querySelector("#blurb")
  const searchbar = document.querySelector("#searchbar")
  const suggestions = document.querySelector("#suggestions")
  const template = document.querySelector("#suggestion")

  // is this a security leak?? no...
  const students = {{ students | tojson }}

  searchbar.oninput = (event) => {

    suggestions.classList.remove("hidden")

    const prefix = event.target.value.toLowerCase()

    const matching_students = students.filter((student) =>
      student.name.toLowerCase().startsWith(prefix)
      || student.email.startsWith(prefix)
    ).slice(0, 20)

    suggestions.replaceChildren(...matching_students.map((student) => {
      // I really hate vanilla js...
      const li = template.content.cloneNode(deep=true)

      li.querySelector("a").href = `/${student.email}`
      li.querySelector("p").innerText = student.name
      li.querySelector("small").innerText = student.email

      return li
    }))

    if (!matching_students.length)
      suggestions.innerText = "No matching students."
  }

  searchbar.onfocus = (event) => {
    if (event.target.value)
      suggestions.classList.remove("hidden")
  }

  {# searchbar.onblur = (event) => {
    suggestions.classList.add("hidden")
  } #}
</script>

{% endblock main %}
